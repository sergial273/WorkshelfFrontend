<div class="container mt-5">
  <div class="jumbotron p-5 bg-light text-dark mb-0">
    <div class="container">
      <div class="row">

        <!-- LEFT SIDE -->
        <div class="col order-2 order-md-1 card">
          <div class="my-2 py-2 d-flex">
            <div class="card-body p-4">
              <h2 class="display-4 mb-5 text-center">{{ book.title }}</h2>
              <div class="row">
                <div class="col-sm-12 col-md-6 d-flex justify-content-center mb-3">
                  <div class="w-100 text-center">
                    <img src="{{ book.image }}" alt="{{ book.title }}" class="card-img-top mb-3 img-fluid rounded" />
                  </div>
                </div>
                  <div class="col-md-6 col-sm-12 mb-3 d-flex flex-column align-items-center">
                    <table class="table table-responsive">
                      <tbody>
                        <tr>
                          <td>Title</td>
                          <td>{{ book.title }}</td>
                        </tr>
                        <tr>
                          <td>Author</td>
                          <td>{{ book.author }}</td>
                        </tr>
                        <tr>
                          <td>Genre</td>
                          <td>{{ book.genre }}</td>
                        </tr>
                        <tr>
                          <td>Publisher</td>
                          <td>{{ book.editorial.editorialName }}</td>
                        </tr>
                        <tr>
                          <td>Reservation status</td>
                          <td>{{ book.reserved === 0 ? 'Available' : 'Reserved' }}</td>
                        </tr>
                      </tbody>
                    </table>
                    <div class="mt-3 d-flex flex-column align-items-center mt-4 w-50">
                      @if (isAvailable) {
                        <button class="btn btn-primary btn-sm my-2 w-100" data-type="theme" [attr.data-id]="book.id" (click)="createReservation(book)">Reserve</button>
                      } @if (isReservedByCurrentUser && !isAvailable) {
                        <button class="btn btn-primary btn-sm my-2 w-100" data-type="theme" [attr.data-id]="book.id" (click)="returnBook(book)">Return</button>
                        <button class="btn btn-primary btn-sm my-2 w-100" data-type="theme" [attr.data-id]="book.id" (click)="rateBook(book)">Rate</button>
                      }
                      <button class="btn btn-primary btn-sm my-2 w-100" data-type="theme" [attr.data-id]="book.id" (click)="viewBookReservations(book)">View Reservations</button>
                    </div>
                  </div>

                </div>
            </div>
          </div>

          <!-- RIGHT SIDE -->
          <div class="col-md-6 col-lg-12 order-1 order-md-2 p-5">
            <div class="container text-dark">
              <div class="row justify-content-center overflow-auto">
                <div class="col-md-12 col-lg-10 col-xl-8">
                  <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="text-dark mb-0">Comments ({{ ratings.length }})</h4>
                  </div>
                  @for (rating of ratings; track $index) {
                    <div class="card mb-3">
                      <div class="card-body">
                        <div class="d-flex flex-start">
                          <div class="w-100">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                              <h6 class="text-primary fw-bold mb-0">
                                {{ rating.user.username }}
                                <span class="text-dark ms-2">{{ rating.comment }}</span>
                              </h6>
                              <p class="small mb-0 d-flex">
                                @for (star of getStarArray(rating.score, 5); track $index) {
                                  <i class="bi bi-star-fill" [style.color]="$index <= rating.score-1 ? '#e5e10a' : '#b4b4b4'"></i>
                                }
                              </p>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  }
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  @if(rating){
    <div id="div-centrado">
      <form>
        <div class="form-group">
          <label for="exampleFormControlSelect1">Rating:</label>
          <select class="form-control" id="exampleFormControlSelect1" [(ngModel)]="ratingToAdd.score" [ngModelOptions]="{standalone: true}">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
          </select>
        </div>
  
        <div class="form-group">
          <label for="exampleFormControlTextarea1">What's your opinion?</label>
          <textarea class="form-control" id="exampleFormControlTextarea1" rows="3" [(ngModel)]="ratingToAdd.comment" [ngModelOptions]="{standalone: true}"></textarea>
        </div>
        <button type="button" class="btn btn-danger" (click)="rating=false">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="addRating()">Submit</button>
      </form>
    </div>
  }

</div>

